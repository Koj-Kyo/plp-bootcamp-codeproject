<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©tails du Rendez-vous - TeleHealth Connect</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .detail-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .detail-row {
            display: flex;
            padding: 15px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .detail-row:last-child {
            border-bottom: none;
        }
        .detail-label {
            font-weight: 600;
            color: #6b7280;
            width: 180px;
        }
        .detail-value {
            flex: 1;
            color: #111827;
        }
        .status-update-form {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="{{ url_for('doctor.dashboard') }}" class="logo">üè• TeleHealth Connect</a>
            <div class="nav-links">
                <a href="{{ url_for('doctor.dashboard') }}">Tableau de bord</a>
                <a href="{{ url_for('doctor.appointments') }}" class="active">Mes rendez-vous</a>
                <a href="{{ url_for('doctor.logout') }}" class="btn-logout">D√©connexion</a>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 30px;">
        <div class="page-header">
            <h1>üìã D√©tails du Rendez-vous</h1>
            <a href="{{ url_for('doctor.appointments') }}" class="btn btn-secondary">‚Üê Retour</a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Appointment Details -->
        <div class="detail-card">
            <h2>üìÖ Informations du Rendez-vous</h2>
            <div class="detail-row">
                <div class="detail-label">Date</div>
                <div class="detail-value">{{ appointment.appointment_date.strftime('%d/%m/%Y') }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Heure</div>
                <div class="detail-value">{{ appointment.appointment_time.strftime('%H:%M') }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Statut</div>
                <div class="detail-value">
                    <span class="status-badge status-{{ appointment.status }}">
                        {{ appointment.status|upper }}
                    </span>
                </div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Raison de visite</div>
                <div class="detail-value">{{ appointment.reason or 'Non sp√©cifi√©' }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Cr√©√© le</div>
                <div class="detail-value">{{ appointment.created_at.strftime('%d/%m/%Y √† %H:%M') }}</div>
            </div>
        </div>

        <!-- Patient Details -->
        <div class="detail-card">
            <h2>üë§ Informations du Patient</h2>
            <div class="detail-row">
                <div class="detail-label">Nom complet</div>
                <div class="detail-value">
                    <strong>{{ appointment.patient.full_name }}</strong>
                    <a href="{{ url_for('doctor.patient_detail', patient_id=appointment.patient.id) }}"
                       style="margin-left: 10px; color: var(--primary-color);">
                        Voir historique ‚Üí
                    </a>
                </div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Email</div>
                <div class="detail-value">{{ appointment.patient.email }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">T√©l√©phone</div>
                <div class="detail-value">{{ appointment.patient.phone }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Date de naissance</div>
                <div class="detail-value">{{ appointment.patient.date_of_birth.strftime('%d/%m/%Y') }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Genre</div>
                <div class="detail-value">{{ 'Homme' if appointment.patient.gender == 'male' else 'Femme' if appointment.patient.gender == 'female' else 'Autre' }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Adresse</div>
                <div class="detail-value">{{ appointment.patient.address or 'Non sp√©cifi√©' }}</div>
            </div>
        </div>

        <!-- Notes and Status Update -->
        <div class="detail-card">
            <h2>üìù Notes et Gestion du Rendez-vous</h2>

            {% if appointment.notes %}
            <div style="background: #fef3c7; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                <strong>Notes existantes:</strong>
                <p style="margin-top: 10px;">{{ appointment.notes }}</p>
            </div>
            {% endif %}

            <div class="status-update-form">
                <form method="POST" action="{{ url_for('doctor.update_appointment_status', appointment_id=appointment.id) }}">
                    <div class="form-group">
                        <label for="status">Changer le statut</label>
                        <select id="status" name="status" class="form-control" required>
                            <option value="scheduled" {% if appointment.status == 'scheduled' %}selected{% endif %}>
                                Programm√©
                            </option>
                            <option value="completed" {% if appointment.status == 'completed' %}selected{% endif %}>
                                Compl√©t√©
                            </option>
                            <option value="cancelled" {% if appointment.status == 'cancelled' %}selected{% endif %}>
                                Annul√©
                            </option>
                            <option value="no-show" {% if appointment.status == 'no-show' %}selected{% endif %}>
                                Non pr√©sent√©
                            </option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="notes">Ajouter/Modifier des notes</label>
                        <textarea id="notes" name="notes" rows="4" class="form-control"
                                  placeholder="Notes sur la consultation, diagnostic, recommandations...">{{ appointment.notes or '' }}</textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        üíæ Mettre √† jour
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
